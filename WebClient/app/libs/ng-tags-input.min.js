(function(){"use strict";function u(){var n={};return{on:function(t,i){return t.split(" ").forEach(function(t){n[t]||(n[t]=[]);n[t].push(i)}),this},trigger:function(t,i){return angular.forEach(n[t],function(n){n.call(null,i)}),this}}}function i(n,t){return n=n||[],n.length>0&&!angular.isObject(n[0])&&n.forEach(function(i,r){n[r]={};n[r][t]=i}),n}function r(n,t,i){for(var u=null,r=0;r<n.length;r++)if(n[r][i].toLowerCase()===t[i].toLowerCase()){u=n[r];break}return u}var n={backspace:8,tab:9,enter:13,escape:27,space:32,up:38,down:40,comma:188},t=angular.module("ngTagsInput",[]).filter("truncate",function(){return function(n,t,i){return isNaN(t)&&(t=10),i===undefined&&(i="..."),n.length<=t||n.length-i.length<=t?n:String(n).substring(0,t-i.length)+i}});t.directive("tagsInput",["$timeout","$document","tagsInputConfig",function(t,f,e){function o(n,t){var i={},u,f,e;return u=function(t){return t[n.displayProperty]},f=function(t,i){t[n.displayProperty]=i},e=function(t){var f=u(t);return f.length>=n.minLength&&f.length<=(n.maxLength||f.length)&&n.allowedTagsPattern.test(f)&&!r(i.items,t,n.displayProperty)},i.items=[],i.addText=function(n){var t={};return f(t,n),i.add(t)},i.add=function(r){var o=u(r).trim();return n.replaceSpacesWithDashes&&(o=o.replace(/\s/g,"-")),f(r,o),e(r)?(i.items.push(r),t.trigger("tag-added",{$tag:r})):t.trigger("invalid-tag",{$tag:r}),r},i.remove=function(n){var r=i.items.splice(n,1)[0];return t.trigger("tag-removed",{$tag:r}),r},i.removeLast=function(){var t,r=i.items.length-1;return n.enableEditingLastTag||i.selected?(i.selected=null,t=i.remove(r)):i.selected||(i.selected=i.items[r]),t},i}return{restrict:"E",require:"ngModel",scope:{tags:"=ngModel",onTagAdded:"&",onTagRemoved:"&"},replace:!1,transclude:!0,templateUrl:"ngTagsInput/tags-input.html",controller:["$scope","$attrs","$element",function(n,t,i){e.load("tagsInput",n,t,{placeholder:[String,"Add a tag"],tabindex:[Number],removeTagSymbol:[String,String.fromCharCode(215)],replaceSpacesWithDashes:[Boolean,!0],minLength:[Number,3],maxLength:[Number],addOnEnter:[Boolean,!0],addOnSpace:[Boolean,!1],addOnComma:[Boolean,!0],addOnBlur:[Boolean,!0],allowedTagsPattern:[RegExp,/.+/],enableEditingLastTag:[Boolean,!1],minTags:[Number],maxTags:[Number],displayProperty:[String,"text"],allowLeftoverText:[Boolean,!1],addFromAutocompleteOnly:[Boolean,!1]});n.events=new u;n.tagList=new o(n.options,n.events);this.registerAutocomplete=function(){var t=i.find("input");t.on("keydown",function(t){n.events.trigger("input-keydown",t)});return{addTag:function(t){return n.tagList.add(t)},focusInput:function(){t[0].focus()},getTags:function(){return n.tags},getOptions:function(){return n.options},on:function(t,i){n.events.on(t,i);return this}}}}],link:function(r,u,e,o){var a=[n.enter,n.comma,n.space,n.backspace],h=r.tagList,c=r.events,s=r.options,l=u.find("input");c.on("tag-added",r.onTagAdded).on("tag-removed",r.onTagRemoved).on("tag-added",function(){r.newTag.text=""}).on("tag-added tag-removed",function(){o.$setViewValue(r.tags)}).on("invalid-tag",function(){r.newTag.invalid=!0}).on("input-change",function(){h.selected=null;r.newTag.invalid=null}).on("input-focus",function(){o.$setValidity("leftoverText",!0)}).on("input-blur",function(){s.addFromAutocompleteOnly||(s.addOnBlur&&h.addText(r.newTag.text),o.$setValidity("leftoverText",s.allowLeftoverText?!0:!r.newTag.text))});r.newTag={text:"",invalid:null};r.getDisplayText=function(n){return n[s.displayProperty].trim()};r.track=function(n){return n[s.displayProperty]};r.newTagChange=function(){c.trigger("input-change",r.newTag.text)};r.$watch("tags",function(n){r.tags=i(n,s.displayProperty);h.items=r.tags});r.$watch("tags.length",function(n){o.$setValidity("maxTags",angular.isUndefined(s.maxTags)||n<=s.maxTags);o.$setValidity("minTags",angular.isUndefined(s.minTags)||n>=s.minTags)});l.on("keydown",function(t){var e;if(!t.isImmediatePropagationStopped||!t.isImmediatePropagationStopped()){var u=t.keyCode,c=t.shiftKey||t.altKey||t.ctrlKey||t.metaKey,i={},f,o;c||a.indexOf(u)===-1||(i[n.enter]=s.addOnEnter,i[n.comma]=s.addOnComma,i[n.space]=s.addOnSpace,f=!s.addFromAutocompleteOnly&&i[u],o=!f&&u===n.backspace&&r.newTag.text.length===0,f?(h.addText(r.newTag.text),r.$apply(),t.preventDefault()):o&&(e=h.removeLast(),e&&s.enableEditingLastTag&&(r.newTag.text=e[s.displayProperty]),r.$apply(),t.preventDefault()))}}).on("focus",function(){r.hasFocus||(r.hasFocus=!0,c.trigger("input-focus"),r.$apply())}).on("blur",function(){t(function(){var n=f.prop("activeElement"),t=n===l[0],i=u[0].contains(n);(t||!i)&&(r.hasFocus=!1,c.trigger("input-blur"))})});u.find("div").on("click",function(){l[0].focus()})}}}]);t.directive("autoComplete",["$document","$timeout","$sce","tagsInputConfig",function(t,u,f,e){function o(n,t){var f={},e,s,o;return s=function(n,i){return n.filter(function(n){return!r(i,n,t.tagsInput.displayProperty)})},f.reset=function(){o=null;f.items=[];f.visible=!1;f.index=-1;f.selected=null;f.query=null;u.cancel(e)},f.show=function(){f.selected=null;f.visible=!0},f.load=function(r,h){if(r.length<t.minLength){f.reset();return}u.cancel(e);e=u(function(){f.query=r;var u=n({$query:r});o=u;u.then(function(n){u===o&&(n=i(n.data||n,t.tagsInput.displayProperty),f.items=s(n,h),f.items.length>0?f.show():f.reset())})},t.debounceDelay,!1)},f.selectNext=function(){f.select(++f.index)},f.selectPrior=function(){f.select(--f.index)},f.select=function(n){n<0?n=f.items.length-1:n>=f.items.length&&(n=0);f.index=n;f.selected=f.items[n]},f.reset(),f}function s(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}return{restrict:"E",require:"^tagsInput",scope:{source:"&"},templateUrl:"ngTagsInput/auto-complete.html",link:function(i,r,u,h){var p=[n.enter,n.tab,n.escape,n.up,n.down],c,l,a,v,y;e.load("autoComplete",i,u,{debounceDelay:[Number,100],minLength:[Number,3],highlightMatchedText:[Boolean,!0],maxResultsToShow:[Number,10]});a=i.options;l=h.registerAutocomplete();a.tagsInput=l.getOptions();c=new o(i.source,a);v=function(n){return n[a.tagsInput.displayProperty]};y=a.highlightMatchedText?function(n,t){var i=new RegExp(t,"gi");return n.replace(i,"**$&**")}:function(n){return n};i.suggestionList=c;i.addSuggestion=function(){var n=!1;return c.selected&&(l.addTag(c.selected),c.reset(),l.focusInput(),n=!0),n};i.highlight=function(n){var t=v(n);return t=y(t,c.query),t=s(t),t=t.replace(/\*\*(.+?)\*\*/g,"<em>$1<\/em>"),f.trustAsHtml(t)};i.track=function(n){return v(n)};l.on("tag-added invalid-tag",function(){c.reset()}).on("input-change",function(n){n?c.load(n,l.getTags()):c.reset()}).on("input-keydown",function(t){var r,u,f;p.indexOf(t.keyCode)!==-1&&(f=!1,t.stopImmediatePropagation=function(){f=!0;t.stopPropagation()},t.isImmediatePropagationStopped=function(){return f},c.visible&&(r=t.keyCode,u=!1,r===n.down?(c.selectNext(),u=!0):r===n.up?(c.selectPrior(),u=!0):r===n.escape?(c.reset(),u=!0):(r===n.enter||r===n.tab)&&(u=i.addSuggestion()),u&&(t.preventDefault(),t.stopImmediatePropagation(),i.$apply())))}).on("input-blur",function(){c.reset()});t.on("click",function(){c.visible&&(c.reset(),i.$apply())})}}}]);t.directive("tiTranscludeAppend",function(){return function(n,t,i,r,u){u(function(n){t.append(n)})}});t.directive("tiAutosize",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){var u,f;u=angular.element('<span class="input"><\/span>');u.css("display","none").css("visibility","hidden").css("width","auto").css("white-space","pre");t.parent().append(u);f=function(n){var t=n,r;return angular.isString(t)&&t.length===0&&(t=i.placeholder),t&&(u.css("display",""),r=u.prop("offsetWidth"),u.css("display","none")),n};r.$parsers.unshift(f);r.$formatters.unshift(f)}}});t.provider("tagsInputConfig",function(){var n={},t={};this.setDefaults=function(t,i){return n[t]=i,this};this.setActiveInterpolation=function(n,i){return t[n]=i,this};this.$get=["$interpolate",function(i){var r={};return r[String]=function(n){return n},r[Number]=function(n){return parseInt(n,10)},r[Boolean]=function(n){return n.toLowerCase()==="true"},r[RegExp]=function(n){return new RegExp(n)},{load:function(u,f,e,o){f.options={};angular.forEach(o,function(o,s){var c,l,a,v,h;c=o[0];l=o[1];a=r[c];v=function(){var t=n[u]&&n[u][s];return angular.isDefined(t)?t:l};h=function(n){f.options[s]=n?a(n):v()};t[u]&&t[u][s]?e.$observe(s,function(n){h(n)}):h(e[s]&&i(e[s])(f.$parent))})}}}]});t.run(["$templateCache",function(n){n.put("ngTagsInput/tags-input.html",'<div class="host" tabindex="-1" ti-transclude-append=""><div class="tags" ng-class="{focused: hasFocus}"><ul class="tag-list"><li class="tag-item" ng-repeat="tag in tagList.items track by track(tag)" ng-class="{ selected: tag == tagList.selected }"><span title="{{getDisplayText(tag)}}">{{getDisplayText(tag)|truncate:16}}<\/span> <a class="remove-button" ng-click="tagList.remove($index)">{{options.removeTagSymbol}}<\/a><\/li><\/ul><input class="input" placeholder="{{options.placeholder}}" tabindex="{{options.tabindex}}" ng-model="newTag.text" ng-change="newTagChange()" ng-trim="false" ng-class="{\'invalid-tag\': newTag.invalid}" ti-autosize=""><\/div><\/div>');n.put("ngTagsInput/auto-complete.html",'<div class="autocomplete" ng-show="suggestionList.visible"><ul class="suggestion-list"><li class="suggestion-item" ng-repeat="item in suggestionList.items | limitTo:options.maxResultsToShow track by track(item)" ng-class="{selected: item == suggestionList.selected}" ng-click="addSuggestion()" ng-mouseenter="suggestionList.select($index)" ng-bind-html="highlight(item)"><\/li><\/ul><\/div>')}])})();
//# sourceMappingURL=ng-tags-input.min.js.map